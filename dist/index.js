class w extends Error{response;request;options;constructor(e,s,r){const o=e.status||e.status===0?e.status:"",n=e.statusText??"",i=`${o} ${n}`.trim(),c=i?`status code ${i}`:"an unknown error";super(`Request failed with ${c}: ${s.method} ${s.url}`),this.name="HTTPError",this.response=e,this.request=s,this.options=r}}class q extends Error{name="NonError";value;constructor(e){let s="Non-error value was thrown";try{typeof e=="string"?s=e:e&&typeof e=="object"&&"message"in e&&typeof e.message=="string"&&(s=e.message)}catch{}super(s),this.value=e}}class m extends Error{name="ForceRetryError";customDelay;code;customRequest;constructor(e){const s=e?.cause?e.cause instanceof Error?e.cause:new q(e.cause):void 0;super(e?.code?`Forced retry: ${e.code}`:"Forced retry",s?{cause:s}:void 0),this.customDelay=e?.delay,this.code=e?.code,this.customRequest=e?.request}}const k=(()=>{let t=!1,e=!1;const s=typeof globalThis.ReadableStream=="function",r=typeof globalThis.Request=="function";if(s&&r)try{e=new globalThis.Request("https://empty.invalid",{body:new globalThis.ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type")}catch(o){if(o instanceof Error&&o.message==="unsupported BodyInit type")return!1;throw o}return t&&!e})(),J=typeof globalThis.AbortController=="function",x=typeof globalThis.AbortSignal=="function"&&typeof globalThis.AbortSignal.any=="function",V=typeof globalThis.ReadableStream=="function",W=typeof globalThis.FormData=="function",A=["get","post","put","patch","head","delete"],Y={json:"application/json",text:"text/*",formData:"multipart/form-data",arrayBuffer:"*/*",blob:"*/*",bytes:"*/*"},g=2147483647,K=new TextEncoder().encode("------WebKitFormBoundaryaxpyiPgbbPti10Rw").length,I=Symbol("stop");class j{options;constructor(e){this.options=e}}const X=t=>new j(t),G={json:!0,parseJson:!0,stringifyJson:!0,searchParams:!0,prefixUrl:!0,retry:!0,timeout:!0,hooks:!0,throwHttpErrors:!0,onDownloadProgress:!0,onUploadProgress:!0,fetch:!0,context:!0},Q={next:!0},Z={method:!0,headers:!0,body:!0,mode:!0,credentials:!0,cache:!0,redirect:!0,referrer:!0,referrerPolicy:!0,integrity:!0,keepalive:!0,signal:!0,window:!0,duplex:!0},ee=t=>{if(!t)return 0;if(t instanceof FormData){let e=0;for(const[s,r]of t)e+=K,e+=new TextEncoder().encode(`Content-Disposition: form-data; name="${s}"`).length,e+=typeof r=="string"?new TextEncoder().encode(r).length:r.size;return e}if(t instanceof Blob)return t.size;if(t instanceof ArrayBuffer)return t.byteLength;if(typeof t=="string")return new TextEncoder().encode(t).length;if(t instanceof URLSearchParams)return new TextEncoder().encode(t.toString()).length;if("byteLength"in t)return t.byteLength;if(typeof t=="object"&&t!==null)try{const e=JSON.stringify(t);return new TextEncoder().encode(e).length}catch{return 0}return 0},v=(t,e,s)=>{let r,o=0;return t.pipeThrough(new TransformStream({transform(n,i){if(i.enqueue(n),r){o+=r.byteLength;let c=e===0?0:o/e;c>=1&&(c=1-Number.EPSILON),s?.({percent:c,totalBytes:Math.max(e,o),transferredBytes:o},r)}r=n},flush(){r&&(o+=r.byteLength,s?.({percent:1,totalBytes:Math.max(e,o),transferredBytes:o},r))}}))},te=(t,e)=>{if(!t.body)return t;if(t.status===204)return new Response(null,{status:t.status,statusText:t.statusText,headers:t.headers});const s=Math.max(0,Number(t.headers.get("content-length"))||0);return new Response(v(t.body,s,e),{status:t.status,statusText:t.statusText,headers:t.headers})},se=(t,e,s)=>{if(!t.body)return t;const r=ee(s??t.body);return new Request(t,{duplex:"half",body:v(t.body,r,e)})},h=t=>t!==null&&typeof t=="object",p=(...t)=>{for(const e of t)if((!h(e)||Array.isArray(e))&&e!==void 0)throw new TypeError("The `options` argument must be an object");return S({},...t)},U=(t={},e={})=>{const s=new globalThis.Headers(t),r=e instanceof globalThis.Headers,o=new globalThis.Headers(e);for(const[n,i]of o.entries())r&&i==="undefined"||i===void 0?s.delete(n):s.set(n,i);return s};function y(t,e,s){return Object.hasOwn(e,s)&&e[s]===void 0?[]:S(t[s]??[],e[s]??[])}const O=(t={},e={})=>({beforeRequest:y(t,e,"beforeRequest"),beforeRetry:y(t,e,"beforeRetry"),afterResponse:y(t,e,"afterResponse"),beforeError:y(t,e,"beforeError")}),re=(t,e)=>{const s=new URLSearchParams;for(const r of[t,e])if(r!==void 0)if(r instanceof URLSearchParams)for(const[o,n]of r.entries())s.append(o,n);else if(Array.isArray(r))for(const o of r){if(!Array.isArray(o)||o.length!==2)throw new TypeError("Array search parameters must be provided in [[key, value], ...] format");s.append(String(o[0]),String(o[1]))}else if(h(r))for(const[o,n]of Object.entries(r))n!==void 0&&s.append(o,String(n));else{const o=new URLSearchParams(r);for(const[n,i]of o.entries())s.append(n,i)}return s},S=(...t)=>{let e={},s={},r={},o;const n=[];for(const i of t)if(Array.isArray(i))Array.isArray(e)||(e=[]),e=[...e,...i];else if(h(i)){for(let[c,a]of Object.entries(i)){if(c==="signal"&&a instanceof globalThis.AbortSignal){n.push(a);continue}if(c==="context"){if(a!=null&&(!h(a)||Array.isArray(a)))throw new TypeError("The `context` option must be an object");e={...e,context:a==null?{}:{...e.context,...a}};continue}if(c==="searchParams"){a==null?o=void 0:o=o===void 0?a:re(o,a);continue}h(a)&&c in e&&(a=S(e[c],a)),e={...e,[c]:a}}h(i.hooks)&&(r=O(r,i.hooks),e.hooks=r),h(i.headers)&&(s=U(s,i.headers),e.headers=s)}return o!==void 0&&(e.searchParams=o),n.length>0&&(n.length===1?e.signal=n[0]:x?e.signal=AbortSignal.any(n):e.signal=n.at(-1)),e.context===void 0&&(e.context={}),e},oe=t=>A.includes(t)?t.toUpperCase():t,ne=["get","put","head","delete","options","trace"],ie=[408,413,429,500,502,503,504],ae=[413,429,503],E={limit:2,methods:ne,statusCodes:ie,afterStatusCodes:ae,maxRetryAfter:Number.POSITIVE_INFINITY,backoffLimit:Number.POSITIVE_INFINITY,delay:t=>.3*2**(t-1)*1e3,jitter:void 0,retryOnTimeout:!1},ce=(t={})=>{if(typeof t=="number")return{...E,limit:t};if(t.methods&&!Array.isArray(t.methods))throw new Error("retry.methods must be an array");if(t.statusCodes&&!Array.isArray(t.statusCodes))throw new Error("retry.statusCodes must be an array");return{...E,...t}};class b extends Error{request;constructor(e){super(`Request timed out: ${e.method} ${e.url}`),this.name="TimeoutError",this.request=e}}async function le(t,e,s,r){return new Promise((o,n)=>{const i=setTimeout(()=>{s&&s.abort(),n(new b(t))},r.timeout);r.fetch(t,e).then(o).catch(n).then(()=>{clearTimeout(i)})})}async function ue(t,{signal:e}){return new Promise((s,r)=>{e&&(e.throwIfAborted(),e.addEventListener("abort",o,{once:!0}));function o(){clearTimeout(n),r(e.reason)}const n=setTimeout(()=>{e?.removeEventListener("abort",o),s()},t)})}const he=(t,e)=>{const s={};for(const r in e)Object.hasOwn(e,r)&&!(r in Z)&&!(r in G)&&(!(r in t)||r in Q)&&(s[r]=e[r]);return s},fe=t=>t===void 0?!1:Array.isArray(t)?t.length>0:t instanceof URLSearchParams?t.size>0:typeof t=="object"?Object.keys(t).length>0:typeof t=="string"?t.trim().length>0:!!t;function de(t){return t instanceof w||t?.name===w.name}function pe(t){return t instanceof b||t?.name===b.name}class d{static create(e,s){const r=new d(e,s),o=async()=>{if(typeof r.#e.timeout=="number"&&r.#e.timeout>g)throw new RangeError(`The \`timeout\` option cannot be greater than ${g}`);await Promise.resolve();let i=await r.#y();for(const c of r.#e.hooks.afterResponse){const a=r.#u(i.clone()),u=await c(r.request,r.#a(),a,{retryCount:r.#s});if(u instanceof globalThis.Response&&(i=u),u instanceof j)throw await Promise.all([a.body?.cancel(),i.body?.cancel()]),new m(u.options)}if(r.#u(i),!i.ok&&(typeof r.#e.throwHttpErrors=="function"?r.#e.throwHttpErrors(i.status):r.#e.throwHttpErrors)){let c=new w(i,r.request,r.#a());for(const a of r.#e.hooks.beforeError)c=await a(c,{retryCount:r.#s});throw c}if(r.#e.onDownloadProgress){if(typeof r.#e.onDownloadProgress!="function")throw new TypeError("The `onDownloadProgress` option must be a function");if(!V)throw new Error("Streams are not supported in your environment. `ReadableStream` is missing.");return te(i.clone(),r.#e.onDownloadProgress)}return i},n=r.#h(o).finally(async()=>{const i=r.#n,c=[];i&&!i.bodyUsed&&c.push(i.body?.cancel()),r.request.bodyUsed||c.push(r.request.body?.cancel()),await Promise.all(c)});for(const[i,c]of Object.entries(Y))i==="bytes"&&typeof globalThis.Response?.prototype?.bytes!="function"||(n[i]=async()=>{r.request.headers.set("accept",r.request.headers.get("accept")||c);const a=await n;if(i==="json"){if(a.status===204)return"";const u=await a.text();return u===""?"":s.parseJson?s.parseJson(u):JSON.parse(u)}return a[i]()});return n}static#d(e){return e&&typeof e=="object"&&!Array.isArray(e)&&!(e instanceof URLSearchParams)?Object.fromEntries(Object.entries(e).filter(([,s])=>s!==void 0)):e}request;#r;#s=0;#t;#e;#n;#o;#i;constructor(e,s={}){if(this.#t=e,this.#e={...s,headers:U(this.#t.headers,s.headers),hooks:O({beforeRequest:[],beforeRetry:[],beforeError:[],afterResponse:[]},s.hooks),method:oe(s.method??this.#t.method??"GET"),prefixUrl:String(s.prefixUrl||""),retry:ce(s.retry),throwHttpErrors:s.throwHttpErrors??!0,timeout:s.timeout??1e4,fetch:s.fetch??globalThis.fetch.bind(globalThis),context:s.context??{}},typeof this.#t!="string"&&!(this.#t instanceof URL||this.#t instanceof globalThis.Request))throw new TypeError("`input` must be a string, URL, or Request");if(this.#e.prefixUrl&&typeof this.#t=="string"){if(this.#t.startsWith("/"))throw new Error("`input` must not begin with a slash when using `prefixUrl`");this.#e.prefixUrl.endsWith("/")||(this.#e.prefixUrl+="/"),this.#t=this.#e.prefixUrl+this.#t}J&&x&&(this.#o=this.#e.signal??this.#t.signal,this.#r=new globalThis.AbortController,this.#e.signal=this.#o?AbortSignal.any([this.#o,this.#r.signal]):this.#r.signal),k&&(this.#e.duplex="half"),this.#e.json!==void 0&&(this.#e.body=this.#e.stringifyJson?.(this.#e.json)??JSON.stringify(this.#e.json),this.#e.headers.set("content-type",this.#e.headers.get("content-type")??"application/json"));const r=s.headers&&new globalThis.Headers(s.headers).has("content-type");if(this.#t instanceof globalThis.Request&&(W&&this.#e.body instanceof globalThis.FormData||this.#e.body instanceof URLSearchParams)&&!r&&this.#e.headers.delete("content-type"),this.request=new globalThis.Request(this.#t,this.#e),fe(this.#e.searchParams)){const n="?"+(typeof this.#e.searchParams=="string"?this.#e.searchParams.replace(/^\?/,""):new URLSearchParams(d.#d(this.#e.searchParams)).toString()),i=this.request.url.replace(/(?:\?.*?)?(?=#|$)/,n);this.request=new globalThis.Request(i,this.#e)}if(this.#e.onUploadProgress){if(typeof this.#e.onUploadProgress!="function")throw new TypeError("The `onUploadProgress` option must be a function");if(!k)throw new Error("Request streams are not supported in your environment. The `duplex` option for `Request` is not available.");this.request=this.#f(this.request,this.#e.body??void 0)}}#c(){const e=this.#e.retry.delay(this.#s);let s=e;return this.#e.retry.jitter===!0?s=Math.random()*e:typeof this.#e.retry.jitter=="function"&&(s=this.#e.retry.jitter(e),(!Number.isFinite(s)||s<0)&&(s=e)),Math.min(this.#e.retry.backoffLimit,s)}async#p(e){if(this.#s++,this.#s>this.#e.retry.limit)throw e;const s=e instanceof Error?e:new q(e);if(s instanceof m)return s.customDelay??this.#c();if(!this.#e.retry.methods.includes(this.request.method.toLowerCase()))throw e;if(this.#e.retry.shouldRetry!==void 0){const r=await this.#e.retry.shouldRetry({error:s,retryCount:this.#s});if(r===!1)throw e;if(r===!0)return this.#c()}if(pe(e)&&!this.#e.retry.retryOnTimeout)throw e;if(de(e)){if(!this.#e.retry.statusCodes.includes(e.response.status))throw e;const r=e.response.headers.get("Retry-After")??e.response.headers.get("RateLimit-Reset")??e.response.headers.get("X-RateLimit-Retry-After")??e.response.headers.get("X-RateLimit-Reset")??e.response.headers.get("X-Rate-Limit-Reset");if(r&&this.#e.retry.afterStatusCodes.includes(e.response.status)){let o=Number(r)*1e3;Number.isNaN(o)?o=Date.parse(r)-Date.now():o>=Date.parse("2024-01-01")&&(o-=Date.now());const n=this.#e.retry.maxRetryAfter??o;return o<n?o:n}if(e.response.status===413)throw e}return this.#c()}#u(e){return this.#e.parseJson&&(e.json=async()=>this.#e.parseJson(await e.text())),e}async#h(e){try{return await e()}catch(s){const r=Math.min(await this.#p(s),g);if(this.#s<1)throw s;if(await ue(r,this.#o?{signal:this.#o}:{}),s instanceof m&&s.customRequest){const o=this.#e.signal?new globalThis.Request(s.customRequest,{signal:this.#e.signal}):new globalThis.Request(s.customRequest);this.#l(o)}for(const o of this.#e.hooks.beforeRetry){const n=await o({request:this.request,options:this.#a(),error:s,retryCount:this.#s});if(n instanceof globalThis.Request){this.#l(n);break}if(n instanceof globalThis.Response)return n;if(n===I)return}return this.#h(e)}}async#y(){this.#r?.signal.aborted&&(this.#r=new globalThis.AbortController,this.#e.signal=this.#o?AbortSignal.any([this.#o,this.#r.signal]):this.#r.signal,this.request=new globalThis.Request(this.request,{signal:this.#e.signal}));for(const s of this.#e.hooks.beforeRequest){const r=await s(this.request,this.#a(),{retryCount:this.#s});if(r instanceof Response)return r;if(r instanceof globalThis.Request){this.#l(r);break}}const e=he(this.request,this.#e);return this.#n=this.request,this.request=this.#n.clone(),this.#e.timeout===!1?this.#e.fetch(this.#n,e):le(this.#n,e,this.#r,this.#e)}#a(){if(!this.#i){const{hooks:e,...s}=this.#e;this.#i=Object.freeze(s)}return this.#i}#l(e){this.#i=void 0,this.request=this.#f(e)}#f(e,s){return!this.#e.onUploadProgress||!e.body?e:se(e,this.#e.onUploadProgress,s??this.#e.body??void 0)}}/*! MIT License Â© Sindre Sorhus */const T=t=>{const e=(s,r)=>d.create(s,p(t,r));for(const s of A)e[s]=(r,o)=>d.create(r,p(t,o,{method:s}));return e.create=s=>T(p(s)),e.extend=s=>(typeof s=="function"&&(s=s(t??{})),T(p(t,s))),e.stop=I,e.retry=X,e},N=T(),ye="https://cloudflare-worker-token-service.audio-pwa.workers.dev/token",me="842170761773-ltlj9t8cap9q1ad7s1h6tb5084ouelod.apps.googleusercontent.com",ge="https://oauth2.googleapis.com/token",L="videogata",C="playlists.json",_="plugins.json",f="https://www.googleapis.com",$="application/vnd.google-apps.folder",P="application/json; charset=UTF-8",F=t=>{application.postUiMessage(t)},l=N.create({hooks:{beforeRequest:[t=>{const e=localStorage.getItem("access_token");return e&&t.headers&&t.headers.set("Authorization","Bearer "+e),t}],afterResponse:[async(t,e,s)=>{if(s.status===401){const r=await we();if(r)return t.headers.set("Authorization","Bearer "+r),l(t,e)}return s}]}}),D=(t,e)=>{localStorage.setItem("access_token",t),e&&localStorage.setItem("refresh_token",e)},we=async()=>{const t=localStorage.getItem("refresh_token");if(!t)return;const e=localStorage.getItem("clientId"),s=localStorage.getItem("clientSecret");let r=ye;const o=new URLSearchParams;o.append("client_id",e||me),o.append("refresh_token",t),o.append("grant_type","refresh_token"),e&&s&&(o.append("client_secret",s),r=ge);const n=await N.post(r,{headers:{"Content-Type":"application/x-www-form-urlencoded"},body:o}).json();if(n.access_token)return D(n.access_token,n.refresh_token),n.access_token},be=async()=>{const e=document.location.host.split(".");e.shift();const s=e.join("."),r=`${document.location.protocol}//${s}`,o=await application.getPluginId(),n=localStorage.getItem("clientId")??"",i=localStorage.getItem("clientSecret")??"";F({type:"info",origin:r,pluginId:o,clientId:n,clientSecret:i})};application.onUiMessage=async t=>{switch(t.type){case"check-login":const e=localStorage.getItem("access_token");e&&F({type:"login",accessToken:e}),await be();break;case"login":D(t.accessToken,t.refreshToken);break;case"logout":localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token");break;case"save-playlists":await Re(),application.createNotification({message:"Playlists Saved!"});break;case"load-playlists":await Se(),application.createNotification({message:"Playlists Loaded!"});break;case"save-plugins":await ke(),application.createNotification({message:"Plugins Saved!"});break;case"install-plugins":Ee();break;case"set-keys":localStorage.setItem("clientId",t.clientId),localStorage.setItem("clientSecret",t.clientSecret),application.createNotification({message:"Api keys Saved!"});break}};const R=async()=>{const t=`mimeType = '${$}' and title = '${L}'`,e=await l.get(`${f}/drive/v2/files?q=${encodeURIComponent(t)}`).json();return e.items.length>0?e.items[0].id:""},M=async t=>{const e=await H(t);return e?await l.get(`${f}/drive/v2/files/${e}?alt=media`).json():void 0},H=async t=>{const e=await R();if(!e)return;const s=`'${e}' in parents and title = '${t}'`,r=await l.get(`${f}/drive/v2/files?q=${encodeURIComponent(s)}`).json();return r.items.length>0?r.items[0].id:""},Te=async()=>{await l.post(f+"/drive/v2/files",{json:{title:L,mimeType:$}})},z=async(t,e)=>{let s=await R();s||(await Te(),s=await R());const r=await H(t);if(r){const n=(await l.put(f+`/upload/drive/v2/files/${r}?uploadType=resumable`,{json:{mimeType:P}})).headers.get("location");if(!n)throw new Error("Upload location header not found");await l.put(n,{body:JSON.stringify(e)})}else{const n=(await l.post(f+"/upload/drive/v2/files?uploadType=resumable",{json:{title:t,parents:[{id:s}],mimeType:P}})).headers.get("location");if(!n)throw new Error("Upload location header not found");await l.post(n,{body:JSON.stringify(e)})}},Re=async()=>{const t=await application.getPlaylists();await z(C,t)},Se=async()=>{const t=await M(C);t&&await application.addPlaylists(t)},ke=async()=>{const t=await application.getPlugins();await z(_,t)},Ee=async()=>{const t=await M(_);t&&await application.installPlugins(t)},B=t=>{localStorage.setItem("vite-ui-theme",t)};application.onChangeTheme=async t=>{B(t)};const Pe=async()=>{const t=await application.getTheme();B(t)};Pe();
